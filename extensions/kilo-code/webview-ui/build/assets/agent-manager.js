import{r as g,I as wt,c as Y,R as Be,u as F,j as n,S as Z,b as oe,C as _t,e as ne,f as M,a as Oe,g as kt,h as Qe,i as St,k as jt,l as Nt,m as Mt,n as qe,o as We,p as Ct,X as At,T as It,q as Tt,s as Et,d as Rt,t as Bt,E as zt}from"./chunk-BGL6E8GX.js";import{P as Dt,L as O,R as Ft,G as K,F as le,S as Pt,M as Lt,r as Ot,C as qt,a as Se,c as Wt,b as je,K as Vt,s as Ne,d as Ve,U as $t,e as Ut,i as Ze,f as Ht,g as Je,Z as Kt}from"./chunk-BpIsI7eN.js";import"./mermaid-bundle.js";function Qt({i18n:e,defaultNS:t,children:s}){const o=g.useMemo(()=>({i18n:e,defaultNS:t}),[e,t]);return g.createElement(wt.Provider,{value:o},s)}/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],Jt=Y("arrow-right-left",Zt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ze=Y("circle-alert",Gt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Xt=Y("circle-check",Yt);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ts=Y("circle",es);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]],ns=Y("git-pull-request",ss);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],as=Y("layers",os);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],is=Y("loader",rs);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],ls=Y("terminal",cs),H={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Ge(e){return"init"in e}function Me(e){return!!e.write}function $e(e){return"v"in e||"e"in e}function de(e){if("e"in e)throw e.e;if((H?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v}const ue=new WeakMap;function Ye(e){var t;return me(e)&&!!((t=ue.get(e))!=null&&t[0])}function ds(e){const t=ue.get(e);t!=null&&t[0]&&(t[0]=!1,t[1].forEach(s=>s()))}function Ce(e,t){let s=ue.get(e);if(!s){s=[!0,new Set],ue.set(e,s);const o=()=>{s[0]=!1};e.then(o,o)}s[1].add(t)}function me(e){return typeof(e==null?void 0:e.then)=="function"}function Xe(e,t,s){if(!s.p.has(e)){s.p.add(e);const o=()=>s.p.delete(e);t.then(o,o)}}function et(e,t,s){var o;const a=new Set;for(const r of((o=s.get(e))==null?void 0:o.t)||[])s.has(r)&&a.add(r);for(const r of t.p)a.add(r);return a}const us=(e,t,...s)=>t.read(...s),ms=(e,t,...s)=>t.write(...s),ps=(e,t)=>{var s;return(s=t.unstable_onInit)==null?void 0:s.call(t,e)},hs=(e,t,s)=>{var o;return(o=t.onMount)==null?void 0:o.call(t,s)},gs=(e,t)=>{var s;const o=z(e),a=o[0],r=o[6],d=o[9];if((H?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let i=a.get(t);return i||(i={d:new Map,p:new Set,n:0},a.set(t,i),(s=r.i)==null||s.call(r,t),d==null||d(e,t)),i},fs=e=>{const t=z(e),s=t[1],o=t[3],a=t[4],r=t[5],d=t[6],i=t[13],l=[],u=c=>{try{c()}catch(p){l.push(p)}};do{d.f&&u(d.f);const c=new Set,p=c.add.bind(c);o.forEach(m=>{var h;return(h=s.get(m))==null?void 0:h.l.forEach(p)}),o.clear(),r.forEach(p),r.clear(),a.forEach(p),a.clear(),c.forEach(u),o.size&&i(e)}while(o.size||r.size||a.size);if(l.length)throw new AggregateError(l)},xs=e=>{const t=z(e),s=t[1],o=t[2],a=t[3],r=t[11],d=t[14],i=t[17],l=[],u=new WeakSet,c=new WeakSet,p=Array.from(a);for(;p.length;){const m=p[p.length-1],h=r(e,m);if(c.has(m)){p.pop();continue}if(u.has(m)){if(o.get(m)===h.n)l.push([m,h]);else if((H?"production":void 0)!=="production"&&o.has(m))throw new Error("[Bug] invalidated atom exists");c.add(m),p.pop();continue}u.add(m);for(const b of et(m,h,s))u.has(b)||p.push(b)}for(let m=l.length-1;m>=0;--m){const[h,b]=l[m];let S=!1;for(const x of b.d.keys())if(x!==h&&a.has(x)){S=!0;break}S&&(d(e,h),i(e,h)),o.delete(h)}},Ae=new WeakSet,vs=(e,t)=>{var s,o;const a=z(e),r=a[1],d=a[2],i=a[3],l=a[6],u=a[7],c=a[11],p=a[12],m=a[13],h=a[14],b=a[16],S=a[17],x=c(e,t);if($e(x)&&(r.has(t)&&d.get(t)!==x.n||Array.from(x.d).every(([A,U])=>h(e,A).n===U)))return x;x.d.clear();let w=!0;function _(){r.has(t)&&(S(e,t),m(e),p(e))}function j(A){var U;if(A===t){const L=c(e,A);if(!$e(L))if(Ge(A))pe(e,A,A.init);else throw new Error("no atom init");return de(L)}const B=h(e,A);try{return de(B)}finally{x.d.set(A,B.n),Ye(x.v)&&Xe(t,x.v,B),(U=r.get(A))==null||U.t.add(t),w||_()}}let y,N;const k={get signal(){return y||(y=new AbortController),y.signal},get setSelf(){return(H?"production":void 0)!=="production"&&!Me(t)&&console.warn("setSelf function cannot be used with read-only atom"),!N&&Me(t)&&(N=(...A)=>{if((H?"production":void 0)!=="production"&&w&&console.warn("setSelf function cannot be called in sync"),!w)try{return b(e,t,...A)}finally{m(e),p(e)}}),N}},D=x.n;try{(H?"production":void 0)!=="production"&&Ae.delete(e);const A=u(e,t,j,k);return(H?"production":void 0)!=="production"&&Ae.has(e)&&console.warn("Detected store mutation during atom read. This is not supported."),pe(e,t,A),me(A)&&(Ce(A,()=>y==null?void 0:y.abort()),A.then(_,_)),(s=l.r)==null||s.call(l,t),x}catch(A){return delete x.v,x.e=A,++x.n,x}finally{w=!1,D!==x.n&&d.get(t)===D&&(d.set(t,x.n),i.add(t),(o=l.c)==null||o.call(l,t))}},bs=(e,t)=>{const s=z(e),o=s[1],a=s[2],r=s[11],d=[t];for(;d.length;){const i=d.pop(),l=r(e,i);for(const u of et(i,l,o)){const c=r(e,u);a.set(u,c.n),d.push(u)}}},tt=(e,t,...s)=>{const o=z(e),a=o[3],r=o[6],d=o[8],i=o[11],l=o[12],u=o[13],c=o[14],p=o[15],m=o[17];let h=!0;const b=x=>de(c(e,x)),S=(x,...w)=>{var _;const j=i(e,x);try{if(x===t){if(!Ge(x))throw new Error("atom not writable");(H?"production":void 0)!=="production"&&Ae.add(e);const y=j.n,N=w[0];pe(e,x,N),m(e,x),y!==j.n&&(a.add(x),(_=r.c)==null||_.call(r,x),p(e,x));return}else return tt(e,x,...w)}finally{h||(u(e),l(e))}};try{return d(e,t,b,S,...s)}finally{h=!1}},ys=(e,t)=>{var s;const o=z(e),a=o[1],r=o[3],d=o[6],i=o[11],l=o[15],u=o[18],c=o[19],p=i(e,t),m=a.get(t);if(m&&!Ye(p.v)){for(const[h,b]of p.d)if(!m.d.has(h)){const S=i(e,h);u(e,h).t.add(t),m.d.add(h),b!==S.n&&(r.add(h),(s=d.c)==null||s.call(d,h),l(e,h))}for(const h of m.d||[])if(!p.d.has(h)){m.d.delete(h);const b=c(e,h);b==null||b.t.delete(t)}}},st=(e,t)=>{var s;const o=z(e),a=o[1],r=o[4],d=o[6],i=o[10],l=o[11],u=o[12],c=o[13],p=o[14],m=o[16],h=l(e,t);let b=a.get(t);if(!b){p(e,t);for(const S of h.d.keys())st(e,S).t.add(t);if(b={l:new Set,d:new Set(h.d.keys()),t:new Set},a.set(t,b),(s=d.m)==null||s.call(d,t),Me(t)){const S=()=>{let x=!0;const w=(..._)=>{try{return m(e,t,..._)}finally{x||(c(e),u(e))}};try{const _=i(e,t,w);_&&(b.u=()=>{x=!0;try{_()}finally{x=!1}})}finally{x=!1}};r.add(S)}}return b},ws=(e,t)=>{var s;const o=z(e),a=o[1],r=o[5],d=o[6],i=o[11],l=o[19],u=i(e,t);let c=a.get(t);if(c&&!c.l.size&&!Array.from(c.t).some(p=>{var m;return(m=a.get(p))==null?void 0:m.d.has(t)})){c.u&&r.add(c.u),c=void 0,a.delete(t),(s=d.u)==null||s.call(d,t);for(const p of u.d.keys()){const m=l(e,p);m==null||m.t.delete(t)}return}return c},pe=(e,t,s)=>{const o=z(e)[11],a=o(e,t),r="v"in a,d=a.v;if(me(s))for(const i of a.d.keys())Xe(t,s,o(e,i));a.v=s,delete a.e,(!r||!Object.is(d,a.v))&&(++a.n,me(d)&&ds(d))},_s=(e,t)=>{const s=z(e)[14];return de(s(e,t))},ks=(e,t,...s)=>{const o=z(e),a=o[12],r=o[13],d=o[16];try{return d(e,t,...s)}finally{r(e),a(e)}},Ss=(e,t,s)=>{const o=z(e),a=o[12],r=o[18],d=o[19],l=r(e,t).l;return l.add(s),a(e),()=>{l.delete(s),d(e,t),a(e)}},nt=new WeakMap,z=e=>{const t=nt.get(e);if((H?"production":void 0)!=="production"&&!t)throw new Error("Store must be created by buildStore to read its building blocks");return t};function js(...e){const t={get(o){const a=z(t)[21];return a(t,o)},set(o,...a){const r=z(t)[22];return r(t,o,...a)},sub(o,a){const r=z(t)[23];return r(t,o,a)}},s=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},us,ms,ps,hs,gs,fs,xs,vs,bs,tt,ys,st,ws,pe,_s,ks,Ss,void 0].map((o,a)=>e[a]||o);return nt.set(t,Object.freeze(s)),t}const ot={};let Ns=0;function v(e,t){const s=`atom${++Ns}`,o={toString(){return(ot?"production":void 0)!=="production"&&this.debugLabel?s+":"+this.debugLabel:s}};return typeof e=="function"?o.read=e:(o.init=e,o.read=Ms,o.write=Cs),t&&(o.write=t),o}function Ms(e){return e(this)}function Cs(e,t,s){return t(this,typeof s=="function"?s(e(this)):s)}function at(){return js()}let se;function As(){return se||(se=at(),(ot?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=se),globalThis.__JOTAI_DEFAULT_STORE__!==se&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),se}const Is={},Ie=g.createContext(void 0);function rt(e){return g.useContext(Ie)||As()}function Ts({children:e,store:t}){const s=g.useRef(null);return t?g.createElement(Ie.Provider,{value:t},e):(s.current===null&&(s.current=at()),g.createElement(Ie.Provider,{value:s.current},e))}const Te=e=>typeof(e==null?void 0:e.then)=="function",Ee=e=>{e.status||(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}))},Es=Be.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Ee(e),e)}),we=new WeakMap,Ue=(e,t)=>{let s=we.get(e);return s||(s=new Promise((o,a)=>{let r=e;const d=u=>c=>{r===u&&o(c)},i=u=>c=>{r===u&&a(c)},l=()=>{try{const u=t();Te(u)?(we.set(u,s),r=u,u.then(d(u),i(u)),Ce(u,l)):o(u)}catch(u){a(u)}};e.then(d(e),i(e)),Ce(e,l)}),we.set(e,s)),s};function E(e,t){const{delay:s,unstable_promiseStatus:o=!Be.use}={},a=rt(),[[r,d,i],l]=g.useReducer(c=>{const p=a.get(e);return Object.is(c[0],p)&&c[1]===a&&c[2]===e?c:[p,a,e]},void 0,()=>[a.get(e),a,e]);let u=r;if((d!==a||i!==e)&&(l(),u=a.get(e)),g.useEffect(()=>{const c=a.sub(e,()=>{if(o)try{const p=a.get(e);Te(p)&&Ee(Ue(p,()=>a.get(e)))}catch{}if(typeof s=="number"){setTimeout(l,s);return}l()});return l(),c},[a,e,s,o]),g.useDebugValue(u),Te(u)){const c=Ue(u,()=>a.get(e));return o&&Ee(c),Es(c)}return u}function T(e,t){const s=rt();return g.useCallback((...a)=>{if((Is?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return s.set(e,...a)},[s,e])}function he(e,t){return[E(e),T(e)]}const Rs={};function q(e,t){let s=null;const o=new Map,a=new Set,r=i=>{let l;if(l=o.get(i),l!==void 0)if(s!=null&&s(l[1],i))r.remove(i);else return l[0];const u=e(i);return o.set(i,[u,Date.now()]),d("CREATE",i,u),u},d=(i,l,u)=>{for(const c of a)c({type:i,param:l,atom:u})};return r.unstable_listen=i=>(a.add(i),()=>{a.delete(i)}),r.getParams=()=>o.keys(),r.remove=i=>{{if(!o.has(i))return;const[l]=o.get(i);o.delete(i),d("REMOVE",i,l)}},r.setShouldRemove=i=>{if(s=i,!!s)for(const[l,[u,c]]of o)s(c,l)&&(o.delete(l),d("REMOVE",l,u))},r}const Bs=e=>typeof(e==null?void 0:e.then)=="function";function zs(e=()=>{try{return window.localStorage}catch(s){(Rs?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(s);return}},t){var s;let o,a;const r={getItem:(l,u)=>{var c,p;const m=b=>{if(b=b||"",o!==b){try{a=JSON.parse(b,t==null?void 0:t.reviver)}catch{return u}o=b}return a},h=(p=(c=e())==null?void 0:c.getItem(l))!=null?p:null;return Bs(h)?h.then(m):m(h)},setItem:(l,u)=>{var c;return(c=e())==null?void 0:c.setItem(l,JSON.stringify(u,void 0))},removeItem:l=>{var u;return(u=e())==null?void 0:u.removeItem(l)}},d=l=>(u,c,p)=>l(u,m=>{let h;try{h=JSON.parse(m||"")}catch{h=p}c(h)});let i;try{i=(s=e())==null?void 0:s.subscribe}catch{}return!i&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(i=(l,u)=>{if(!(e()instanceof window.Storage))return()=>{};const c=p=>{p.storageArea===e()&&p.key===l&&u(p.newValue)};return window.addEventListener("storage",c),()=>{window.removeEventListener("storage",c)}}),i&&(r.subscribe=d(i)),r}zs();const f={idle:"idle",creating:"creating",streaming:"streaming",waiting_approval:"waiting_approval",waiting_input:"waiting_input",completed:"completed",paused:"paused",error:"error",stopped:"stopped"};function He(){return{sessionId:void 0,errorMessage:void 0,sawApiReqStarted:!1,sawSessionCreated:!1}}function Ds(){let e=f.idle,t=He();return{getState:()=>e,send:i=>{const{nextState:l,contextUpdate:u}=Fs(e,i,t);e=l,u&&(t={...t,...u})},getUiState:()=>({showSpinner:e===f.creating||e===f.streaming,showCancelButton:e===f.creating||e===f.streaming||e===f.waiting_approval||e===f.waiting_input,isActive:e===f.creating||e===f.streaming||e===f.waiting_approval||e===f.waiting_input}),getContext:()=>({...t}),reset:()=>{e=f.idle,t=He()}}}function Fs(e,t,s){switch(e){case f.idle:return Ps(t);case f.creating:return Ls(t,s);case f.streaming:return Os(t);case f.waiting_approval:return qs(t);case f.waiting_input:return Ws(t);case f.completed:return Vs(t);case f.paused:return $s(t);case f.error:return Us(t);case f.stopped:return Hs(t);default:return{nextState:e}}}function Ps(e){switch(e.type){case"start_session":return{nextState:f.creating};case"session_created":return{nextState:f.streaming,contextUpdate:{sawSessionCreated:!0,sessionId:e.sessionId}};case"api_req_started":return{nextState:f.streaming,contextUpdate:{sawApiReqStarted:!0}};default:return{nextState:f.idle}}}function Ls(e,t){switch(e.type){case"session_created":{const s={sawSessionCreated:!0,sessionId:e.sessionId};return t.sawApiReqStarted?{nextState:f.streaming,contextUpdate:s}:{nextState:f.creating,contextUpdate:s}}case"api_req_started":{const s={sawApiReqStarted:!0};return t.sawSessionCreated?{nextState:f.streaming,contextUpdate:s}:{nextState:f.creating,contextUpdate:s}}case"process_error":return{nextState:f.error,contextUpdate:{errorMessage:e.error}};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.creating}}}function Os(e){switch(e.type){case"say_text":return{nextState:f.streaming};case"api_req_started":return{nextState:f.streaming};case"ask_tool":case"ask_command":case"ask_browser_action_launch":case"ask_use_mcp_server":return e.partial?{nextState:f.streaming}:{nextState:f.waiting_approval};case"ask_followup":return{nextState:f.waiting_input};case"ask_completion_result":return{nextState:f.completed};case"ask_api_req_failed":case"ask_mistake_limit_reached":case"ask_invalid_model":case"ask_payment_required_prompt":return{nextState:f.error};case"ask_resume_task":return{nextState:f.paused};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.streaming}}}function qs(e){switch(e.type){case"approve_action":case"reject_action":case"api_req_started":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.waiting_approval}}}function Ws(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"send_message":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.waiting_input}}}function Vs(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"send_message":return{nextState:f.streaming};case"start_session":return{nextState:f.creating};default:return{nextState:f.completed}}}function $s(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.paused}}}function Us(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"retry":return{nextState:f.streaming};case"cancel_session":return{nextState:f.stopped};default:return{nextState:f.error}}}function Hs(e){switch(e.type){case"api_req_started":return{nextState:f.streaming};case"start_session":return{nextState:f.creating};default:return{nextState:f.stopped}}}const J=v({}),X=v([]),V=v(null),ve=v([]),ge=v(!1),De=v(null),it=v(0),ct=q(e=>v("")),Ks=v("local"),Qs=4,Zs=Array.from({length:Qs},(e,t)=>t+1),Js=v(1);function Gs(e,t){return t===1?[e]:Array.from({length:t},(s,o)=>`${e} (v${o+1})`)}const Ys=v(e=>{const t=e(J);return e(X).map(o=>t[o]).filter(o=>o!==void 0)});function lt(e){const t=e.created_at?new Date(e.created_at).getTime():0,s=e.updated_at?new Date(e.updated_at).getTime():0;return{sessionId:e.session_id,label:e.title||"Untitled",prompt:"",status:"done",startTime:Number.isNaN(t)?0:t,endTime:Number.isNaN(s)?0:s,source:"remote",gitUrl:e.git_url}}const Xs=v(e=>{const t=e(Ys),s=e(ve),o=new Set(t.filter(r=>r.sessionId).map(r=>r.sessionId)),a=s.filter(r=>!o.has(r.session_id)).map(lt);return[...t,...a]}),en=v(e=>{const t=e(V);if(!t)return null;const s=e(J)[t];if(s)return s;const a=e(ve).find(r=>r.session_id===t);return a?lt(a):null}),tn=v(null,(e,t,s)=>{const o=e(J),a=e(X),r=!a.includes(s.sessionId);t(J,{...o,[s.sessionId]:s}),r&&(t(X,[s.sessionId,...a]),e(V)===null&&t(V,s.sessionId))}),sn=v(null,(e,t,s)=>{const o=e(J),{[s]:a,...r}=o;if(t(J,r),t(X,e(X).filter(d=>d!==s)),e(V)===s){const d=e(X);t(V,d[0]||null)}});v(null,(e,t,s)=>{const o=e(J),a=o[s.sessionId];a&&t(J,{...o,[s.sessionId]:{...a,status:s.status,exitCode:s.exitCode,error:s.error,endTime:s.status!=="running"?Date.now():a.endTime}})});v(null,(e,t,s)=>{t(ve,s),t(ge,!1)});const fe=new Map;function nn(e){let t=fe.get(e);return t||(t=Ds(),fe.set(e,t)),t}const ae=v({}),$=v({}),dt=v(null,(e,t,s)=>{const{sessionId:o,event:a}=s,r=nn(o);r.send(a);const d=e(ae),i=e($);t(ae,{...d,[o]:r.getState()}),t($,{...i,[o]:r.getUiState()})});v(null,(e,t,s)=>{const o=fe.get(s);if(o){o.reset();const a=e(ae),r=e($);t(ae,{...a,[s]:o.getState()}),t($,{...r,[s]:o.getUiState()})}});const on=v(null,(e,t,s)=>{fe.delete(s)}),an=v(e=>{const t=e(V);return t?e(ae)[t]??null:null});v(e=>{const t=e(V);return t?e($)[t]??null:null});v(e=>{const t=e($);return s=>{var o;return((o=t[s])==null?void 0:o.showSpinner)??!1}});v(e=>{const t=e($);return s=>{var o;return((o=t[s])==null?void 0:o.showCancelButton)??!1}});v(e=>{const t=e($);return s=>{var o;return((o=t[s])==null?void 0:o.isActive)??!1}});const G=q(e=>v([])),re=q(e=>v(new Map));q(e=>v(t=>{const s=t(G(e));return s[s.length-1]||null}));q(e=>v(t=>t(G(e)).length>0));const rn=v(null,(e,t,s)=>{const{sessionId:o,messages:a}=s,r=e(G(o)),d=e(re(o)),i=cn(r,a,d);t(G(o),i);const l=new Map;i.forEach(c=>l.set(c.ts,Fe(c))),t(re(o),l);const u=new Map(r.map(c=>[c.ts,c]));for(const c of i){const p=u.get(c.ts),m=!p,h=(p==null?void 0:p.partial)&&!c.partial;if(!m&&!h)continue;const b=ln(c);b&&t(dt,{sessionId:o,event:b})}});v(null,(e,t,s)=>{const{sessionId:o,message:a}=s,r=e(G(o)),d=r.findIndex(c=>c.ts===a.ts);if(d===-1)return;const i=[...r];i[d]=a,t(G(o),i);const l=e(re(o)),u=new Map(l);u.set(a.ts,Fe(a)),t(re(o),u)});v(null,(e,t,s)=>{t(G(s),[]),t(re(s),new Map)});function Fe(e){var t,s,o;return(((t=e.text)==null?void 0:t.length)||0)+(((s=e.say)==null?void 0:s.length)||0)+(((o=e.ask)==null?void 0:o.length)||0)}function cn(e,t,s){const o=new Map(e.map(a=>[a.ts,a]));return t.map(a=>{const r=o.get(a.ts);if(!r)return a;if(!r.partial&&a.partial){const d=s.get(a.ts)||0;if(Fe(a)<=d)return r}return a})}function ln(e){const t=e.partial??!1;if(e.type==="say"&&e.say)switch(e.say){case"api_req_started":return{type:"api_req_started"};case"text":case"command_output":case"user_feedback":case"user_feedback_diff":case"api_req_finished":case"api_req_retried":case"completion_result":case"shell_integration_warning":case"checkpoint_saved":return{type:"say_text",partial:t};default:return{type:"say_text",partial:t}}if(e.type==="ask"&&e.ask)switch(e.ask){case"tool":return{type:"ask_tool",partial:t};case"command":return{type:"ask_command",partial:t};case"browser_action_launch":return{type:"ask_browser_action_launch",partial:t};case"use_mcp_server":return{type:"ask_use_mcp_server",partial:t};case"followup":return{type:"ask_followup",partial:t};case"completion_result":return{type:"ask_completion_result"};case"api_req_failed":return{type:"ask_api_req_failed"};case"mistake_limit_reached":return{type:"ask_mistake_limit_reached"};case"invalid_model":return{type:"ask_invalid_model"};case"payment_required_prompt":return{type:"ask_payment_required_prompt"};case"resume_task":return{type:"ask_resume_task"};case"resume_completed_task":return{type:"ask_resume_task"};default:return null}return null}const ut=q(e=>v([]));function dn(e){const t=e.filter(l=>l.status==="completed").length,s=e.length,o=e.find(l=>l.status==="in_progress"),a=e.find(l=>l.status==="pending"),r=o||a,d=s>0&&t===s,i=s>0?t/s*100:0;return{todos:e,completedCount:t,totalCount:s,inProgressTodo:o,nextPendingTodo:a,currentTodo:r,allCompleted:d,progressPercent:i}}const un=q(e=>v(t=>{const s=t(ut(e));return dn(s)})),mn=v(null,(e,t,s)=>{const{sessionId:o,todos:a}=s;t(ut(o),a)}),mt=v([]),pt=v(void 0),pn=v(null,(e,t,s)=>{const{branches:o,currentBranch:a}=s;t(mt,o),t(pt,a)}),Re="agentManager.selectedModelId",Pe=v(!0),be=v(null);function hn(){try{return localStorage.getItem(Re)}catch(e){return console.error("[AgentManager] Failed to read model selection from localStorage:",e),null}}function ht(e){try{e?localStorage.setItem(Re,e):localStorage.removeItem(Re)}catch(t){console.error("[AgentManager] Failed to persist model selection to localStorage:",t)}}const xe=v(hn()),gn=v(e=>{const t=e(xe);if(t)return t;const s=e(be);return(s==null?void 0:s.currentModel)??null}),fn=v(null,(e,t,s)=>{t(be,s),t(Pe,!1);const o=e(xe);o&&(s.models.some(r=>r.id===o)||(t(xe,null),ht(null)))}),xn=v(null,(e,t,s)=>{t(Pe,!1)}),vn=v(null,(e,t,s)=>{t(xe,s),ht(s)});function bn(e){return e.filter(s=>s.type==="ask"&&s.ask==="tool"||s.type==="say"&&s.say==="user_edit_todos").map(s=>{const o=s.metadata;if((o==null?void 0:o.tool)==="updateTodoList"&&Array.isArray(o.todos))return{tool:"updateTodoList",todos:o.todos};try{return JSON.parse(s.text??"{}")}catch{return null}}).filter(s=>s&&s.tool==="updateTodoList"&&Array.isArray(s.todos)).map(s=>s.todos).pop()??[]}function yn(e,t){switch(e){case"api_req_started":return{type:"api_req_started"};case"ask_followup":return{type:"ask_followup",partial:t??!1};case"ask_tool":return{type:"ask_tool",partial:t??!1};case"ask_command":return{type:"ask_command",partial:t??!1};case"ask_browser_action_launch":return{type:"ask_browser_action_launch",partial:t??!1};case"ask_use_mcp_server":return{type:"ask_use_mcp_server",partial:t??!1};case"ask_completion_result":return{type:"ask_completion_result"};case"ask_resume_task":return{type:"ask_resume_task"};case"ask_api_req_failed":return{type:"ask_api_req_failed"};case"ask_mistake_limit_reached":return{type:"ask_mistake_limit_reached"};case"ask_invalid_model":return{type:"ask_invalid_model"};case"ask_payment_required_prompt":return{type:"ask_payment_required_prompt"};case"cancel_session":return{type:"cancel_session"};default:return null}}function wn(){const e=T(rn),t=T(mn),s=T(pn),o=T(fn),a=T(xn),r=T(tn),d=T(sn),i=T(V),l=T(it),u=T(ve),c=T(De),p=T(ge),m=T(dt),h=T(on),b=E(X),S=g.useRef(!1),x=g.useRef(new Set);g.useEffect(()=>{function w(_){const j=_.data;switch(j.type){case"agentManager.chatMessages":{const{sessionId:y,messages:N}=j;e({sessionId:y,messages:N});const k=bn(N);t({sessionId:y,todos:k});break}case"agentManager.state":{const{state:y}=j;for(const k of y.sessions){const D=!x.current.has(k.sessionId);r(k),D&&(x.current.add(k.sessionId),(k.status==="creating"||k.status==="running")&&(m({sessionId:k.sessionId,event:{type:"start_session"}}),m({sessionId:k.sessionId,event:{type:"session_created",sessionId:k.sessionId}}),k.status==="running"&&m({sessionId:k.sessionId,event:{type:"api_req_started"}})))}const N=new Set(y.sessions.map(k=>k.sessionId));for(const k of b)N.has(k)||(d(k),h(k),x.current.delete(k));!S.current&&y.selectedId!==void 0&&(i(y.selectedId),S.current=!0);break}case"agentManager.startSessionFailed":{l(y=>y+1),c(null);break}case"agentManager.remoteSessions":{const{sessions:y}=j;u(y),p(!1);break}case"agentManager.pendingSession":{const{pendingSession:y}=j;c(y);break}case"agentManager.stateEvent":{const{sessionId:y,eventType:N,partial:k}=j,D=yn(N,k);D&&m({sessionId:y,event:D});break}case"agentManager.branches":{const{branches:y,currentBranch:N}=j;s({branches:y,currentBranch:N});break}case"agentManager.availableModels":{const{provider:y,currentModel:N,models:k}=j;o({provider:y,currentModel:N,models:k});break}case"agentManager.modelsLoadFailed":{const{error:y}=j;a(y);break}}}return window.addEventListener("message",w),()=>window.removeEventListener("message",w)},[e,t,s,o,a,r,d,i,l,u,c,p,m,h,b])}const _n=()=>crypto.randomUUID(),P=q(e=>v([])),ye=q(e=>v(null));q(e=>v(t=>t(P(e)).length===0));q(e=>v(t=>t(P(e)).find(o=>o.status==="queued")||null));const kn=v(null,(e,t,s)=>{const{sessionId:o,content:a}=s,r=e(P(o)),d={id:_n(),sessionId:o,content:a,status:"queued",timestamp:Date.now(),retryCount:0,maxRetries:3};return t(P(o),[...r,d]),d}),Sn=v(null,(e,t,s)=>{const{sessionId:o,messageId:a,status:r,error:d}=s,l=e(P(o)).map(u=>u.id===a?{...u,status:r,error:d||void 0}:u);t(P(o),l)}),gt=v(null,(e,t,s)=>{const{sessionId:o,messageId:a}=s,d=e(P(o)).filter(i=>i.id!==a);t(P(o),d)}),jn=v(null,(e,t,s)=>{const{sessionId:o,messageId:a}=s,d=e(P(o)).map(i=>i.id===a&&i.status==="failed"&&i.retryCount<i.maxRetries?{...i,status:"queued",error:void 0,retryCount:i.retryCount+1}:i);t(P(o),d)});v(null,(e,t,s)=>{t(P(s),[]),t(ye(s),null)});const Nn=v(null,(e,t,s)=>{const{sessionId:o,messageId:a}=s;t(ye(o),a)});let _e;function ke(){return _e||(_e=acquireVsCodeApi()),_e}const R={postMessage:e=>ke().postMessage(e),getState:()=>ke().getState(),setState:e=>ke().setState(e)};function Mn(e){const t=E(P(e||"")),s=E(ye(e||"")),o=T(Sn),a=T(gt),r=T(Nn),d=g.useCallback((i,l)=>{e&&(r({sessionId:e,messageId:i}),R.postMessage({type:"agentManager.messageQueued",sessionId:e,messageId:i,content:l}))},[e,r]);g.useEffect(()=>{if(!e)return;const i=l=>{if(l.data.type!=="agentManager.messageStatus")return;const{sessionId:u,messageId:c,status:p,error:m}=l.data;u===e&&((p==="sending"||p==="failed")&&o({sessionId:e,messageId:c,status:p,error:m}),p==="sent"&&(a({sessionId:e,messageId:c}),r({sessionId:e,messageId:null})),p==="failed"&&r({sessionId:e,messageId:null}))};return window.addEventListener("message",i),()=>window.removeEventListener("message",i)},[e,o,a,r]),g.useEffect(()=>{if(!e||s)return;const i=t.find(l=>l.status==="queued");i&&d(i.id,i.content)},[e,t,s,d])}function ft(e,t){if(!e||isNaN(e))return"";const o=Date.now()-e,a=Math.floor(o/1e3),r=Math.floor(a/60),d=Math.floor(r/60),i=Math.floor(d/24);if(i>7){const l=Math.floor(i/7);return l===1?t.weekAgo:t.weeksAgo(l)}return i>0?i===1?t.dayAgo:t.daysAgo(i):d>0?d===1?t.hourAgo:t.hoursAgo(d):r>0?r===1?t.minuteAgo:t.minutesAgo(r):t.justNow}function xt(e){return{justNow:e("time.justNow"),minuteAgo:e("time.minuteAgo"),minutesAgo:t=>e("time.minutesAgo",{count:t}),hourAgo:e("time.hourAgo"),hoursAgo:t=>e("time.hoursAgo",{count:t}),dayAgo:e("time.dayAgo"),daysAgo:t=>e("time.daysAgo",{count:t}),weekAgo:e("time.weekAgo"),weeksAgo:t=>e("time.weeksAgo",{count:t})}}function Cn(){const{t:e}=F("agentManager"),t=E(Xs),s=E(De),[o,a]=he(V),r=E(ge),d=T(ge),i=E($),l=()=>{a(null)},u=m=>{a(m),R.postMessage({type:"agentManager.selectSession",sessionId:m})},c=()=>{r||(d(!0),R.postMessage({type:"agentManager.refreshRemoteSessions"}))},p=o===null&&!s;return n.jsxs("div",{className:"am-sidebar",children:[n.jsx("div",{className:"am-sidebar-header",children:n.jsx("span",{children:e("sidebar.title")})}),n.jsxs("div",{className:`am-new-agent-item ${p?"am-selected":""}`,onClick:l,role:"button",tabIndex:0,onKeyDown:m=>m.key==="Enter"&&l(),children:[n.jsx(Dt,{size:16}),n.jsx("span",{children:e("sidebar.newAgent")})]}),n.jsxs("div",{className:"am-sidebar-section-header",children:[n.jsx("span",{children:e("sidebar.sessionsSection")}),n.jsx("button",{className:"am-icon-btn",onClick:c,disabled:r,title:e("sidebar.refresh"),children:r?n.jsx(O,{size:14,className:"am-spinning"}):n.jsx(Ft,{size:14})})]}),n.jsxs("div",{className:"am-session-list",children:[s&&n.jsx(An,{pendingSession:s,isSelected:o===null,onSelect:()=>a(null)}),t.length===0&&!s?n.jsx("div",{className:"am-no-sessions",children:n.jsx("p",{children:e("sidebar.emptyState")})}):t.map(m=>n.jsx(In,{session:m,isSelected:o===m.sessionId,uiState:i[m.sessionId],onSelect:()=>u(m.sessionId)},m.sessionId))]})]})}function An({pendingSession:e,isSelected:t,onSelect:s}){const{t:o}=F("agentManager");return n.jsxs("div",{className:`am-session-item pending ${t?"am-selected":""}`,onClick:s,children:[n.jsx("div",{className:"am-status-icon creating",title:o("status.creating"),children:n.jsx(O,{size:14,className:"am-spinning"})}),n.jsxs("div",{className:"am-session-content",children:[n.jsx("div",{className:"am-session-label",children:e.label}),n.jsx("div",{className:"am-session-meta",children:o("status.creating")})]})]})}function In({session:e,isSelected:t,uiState:s,onSelect:o}){var _,j;const{t:a}=F("agentManager"),r=g.useMemo(()=>xt(a),[a]),[d,i]=g.useState(!1),[l,u]=g.useState(!1),c=(s==null?void 0:s.showSpinner)??!1,p=(s==null?void 0:s.isActive)??!1,m=(_=e.parallelMode)==null?void 0:_.enabled,h=(j=e.parallelMode)==null?void 0:j.branch,b=e.status==="done",S=y=>{y.stopPropagation(),i(!0)},x=y=>{y.stopPropagation(),i(!1),u(!1),R.postMessage({type:"agentManager.sessionShare",sessionId:e.sessionId})},w=y=>{y.stopPropagation(),i(!1),u(!1)};return n.jsxs("div",{className:`am-session-item ${t?"am-selected":""}`,onClick:o,onMouseEnter:()=>u(!0),onMouseLeave:()=>!d&&u(!1),children:[e.status==="creating"&&n.jsx("div",{className:"am-status-icon creating",title:a("status.creating"),children:n.jsx(O,{size:14,className:"am-spinning"})}),c&&n.jsx("div",{className:"am-status-icon running",title:a("status.running"),children:n.jsx(O,{size:14,className:"am-spinning"})}),n.jsxs("div",{className:"am-session-content",children:[n.jsx("div",{className:"am-session-label",children:e.label}),n.jsxs("div",{className:"am-session-meta",children:[e.status==="creating"&&p?a("status.creating"):ft(e.startTime,r),m&&n.jsxs("span",{className:"am-worktree-indicator",title:h||a("sidebar.worktree"),children:[n.jsx(K,{size:10}),h?n.jsx("span",{className:"am-branch-name",children:h.length>20?h.slice(0,20)+"...":h}):n.jsx("span",{children:a("sidebar.worktree")})]}),!m&&n.jsx("span",{className:"am-workspace-indicator",title:a("sidebar.local"),children:n.jsx(le,{size:10})})]}),m&&b&&n.jsx("div",{className:"am-ready-to-merge",children:a("sidebar.readyToMerge")})]}),(l||d)&&n.jsx("button",{className:"w-5 h-5 border-none bg-transparent rounded-[3px] cursor-pointer flex items-center justify-center -mt-0.5 hover:bg-vscode-toolbar-hoverBackground",onClick:S,title:a("sidebar.shareSession"),"aria-label":a("sidebar.shareSession"),children:n.jsx(Pt,{size:14})}),d&&n.jsxs("div",{className:"absolute top-full left-2 right-2 mt-1 p-3 bg-vscode-dropdown-background border border-vscode-dropdown-border rounded z-[100] shadow-[0_4px_12px_rgba(0,0,0,0.3)]",onClick:y=>y.stopPropagation(),children:[n.jsx("div",{className:"text-sm mb-2",children:a("sidebar.shareConfirmMessage")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{className:"px-3 py-1 rounded-sm text-xs cursor-pointer border border-transparent transition-colors duration-150 bg-vscode-button-background text-vscode-button-foreground hover:bg-vscode-button-hoverBackground",onClick:x,children:a("sidebar.shareConfirmYes")}),n.jsx("button",{className:"px-3 py-1 rounded-sm text-xs cursor-pointer border border-transparent transition-colors duration-150 bg-vscode-button-secondaryBackground text-vscode-button-secondaryForeground hover:bg-vscode-button-secondaryHoverBackground",onClick:w,children:a("sidebar.shareConfirmNo")})]})]})]})}const W=({content:e})=>n.jsx("div",{className:"am-markdown-content",children:n.jsx(Lt,{remarkPlugins:[Ot],children:e})});function Tn({suggestions:e,onSuggestionClick:t,onCopyToInput:s}){const{t:o}=F("agentManager");return e!=null&&e.length?n.jsx("div",{className:"am-followup-suggestions",children:e.map((a,r)=>n.jsxs("div",{className:"am-followup-suggestion-wrapper",children:[n.jsx("button",{type:"button",onClick:()=>t(a),className:"am-followup-suggestion-btn","aria-label":a.answer,children:a.answer}),s&&n.jsx(Z,{content:o("chat:followUpSuggest.copyToInput"),children:n.jsx("button",{type:"button",className:"am-followup-copy-btn",onClick:d=>{d.stopPropagation(),s(a)},"aria-label":o("chat:followUpSuggest.copyToInput"),children:n.jsx(qt,{size:16})})})]},`${a.answer}-${r}`))}):null}function En(e){if(!e)return{command:"",output:""};const t=e.indexOf(Se);if(t===-1)return{command:e,output:""};let s=e.slice(t+Se.length);return s=s.replace(/^\n/,""),s=s.split(`
`).filter(r=>r.trim()!=="command_output").join(`
`).replace(/\n+$/,""),{command:e.slice(0,t).trim(),output:s}}function Rn(e){return e?e.replace(/\u001B\][^\u0007]*(?:\u0007|\u001B\\)/g,"").replace(/\u001B\[[0-?]*[ -/]*[@-~]/g,"").replace(/\u001B./g,"").replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F]/g,""):""}const vt=g.memo(({text:e,isRunning:t=!1,isLast:s=!1,exitCode:o,terminalStatus:a})=>{const{t:r}=F("agentManager"),{command:d,output:i}=g.useMemo(()=>En(e),[e]),[l,u]=g.useState(!0),[c,p]=g.useState(!1),m=g.useMemo(()=>Rn(i),[i]),h=g.useMemo(()=>/\S/.test(m),[m]),b=g.useMemo(()=>e.indexOf(Se)!==-1,[e]),S=o!==void 0||a==="timeout"||a==="exited",x=g.useMemo(()=>!S&&(t||b&&s)&&!h?"running":a==="timeout"||o!==void 0&&o!==0?"error":o===0||h||b?"success":"pending",[S,t,b,s,h,a,o]),w=x==="error",_=async()=>{try{await navigator.clipboard.writeText(d),p(!0),setTimeout(()=>p(!1),2e3)}catch{}};return n.jsxs("div",{className:"bg-vscode-editor-background border border-vscode-panel-border rounded-sm font-mono text-sm",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[n.jsx(Bn,{status:x}),n.jsx("pre",{className:"overflow-x-auto whitespace-pre m-0 p-0 flex-1 min-w-0",children:d})]}),n.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[n.jsx("button",{onClick:_,className:"p-1 text-vscode-descriptionForeground hover:text-vscode-foreground transition-colors rounded hover:bg-vscode-toolbar-hoverBackground",title:r("messages.copyCommand"),children:c?n.jsx(oe,{size:14}):n.jsx(_t,{size:14})}),h&&n.jsx("button",{onClick:()=>u(!l),className:"p-1 text-vscode-descriptionForeground hover:text-vscode-foreground transition-colors rounded hover:bg-vscode-toolbar-hoverBackground",title:r(l?"messages.collapseOutput":"messages.expandOutput"),children:n.jsx(ne,{className:M("size-4 transition-transform duration-200",l&&"rotate-180")})})]})]}),h&&n.jsx("div",{className:M("overflow-hidden transition-all duration-200 border-t border-vscode-panel-border",{"max-h-0 border-t-0":!l,"max-h-[500px] overflow-y-auto":l}),children:n.jsx("div",{className:"p-2 bg-vscode-editor-background",children:n.jsx("pre",{className:M("overflow-x-auto whitespace-pre m-0 p-0 text-xs",w?"text-red-400":"text-vscode-descriptionForeground"),children:m})})})]})});vt.displayName="CommandExecutionBlock";function Bn({status:e}){switch(e){case"pending":return n.jsx("div",{className:"size-2 rounded-full bg-yellow-500/70 flex-shrink-0"});case"running":return n.jsx(O,{size:10,className:"animate-spin text-blue-400 flex-shrink-0"});case"success":return n.jsx("div",{className:"size-2 rounded-full bg-green-500 flex-shrink-0"});case"error":return n.jsx("div",{className:"size-2 rounded-full bg-red-500 flex-shrink-0"})}}function zn(e){if(typeof e=="number")return e;if(typeof e=="string"&&e.trim()&&!Number.isNaN(Number(e)))return Number(e)}function Dn(e){const t=e.metadata;return t?{exitCode:zn(t.exitCode),status:typeof t.status=="string"?t.status:void 0,isRunning:e.partial??!1}:null}function Fn({sessionId:e}){const{t}=F("agentManager"),s=E(G(e)),o=E(P(e)),a=E(ye(e)),r=T(ct(e)),d=T(jn),i=T(gt),l=g.useRef(null),u=g.useMemo(()=>Wt(s),[s]),c=g.useMemo(()=>{const w=new Map;for(let _=0;_<s.length;_++){const j=s[_];if(j.type!=="ask"||j.ask!=="command")continue;let y=null;for(let N=_+1;N<s.length;N++){const k=s[N];if(k.type==="ask"&&k.ask==="command")break;k.ask!=="command_output"&&k.say!=="command_output"||(y=Dn(k))}y&&w.set(j.ts,y)}return w},[s]);g.useEffect(()=>{var w;u.length>0&&((w=l.current)==null||w.scrollToIndex({index:u.length-1,behavior:"smooth"}))},[u.length]);const p=g.useCallback(w=>{R.postMessage({type:"agentManager.sendMessage",sessionId:e,content:w.answer})},[e]),m=g.useCallback(w=>{r(_=>_!==""?`${_} 
${w.answer}`:w.answer)},[r]),h=g.useCallback((w,_)=>{d({sessionId:w,messageId:_})},[d]),b=g.useCallback((w,_)=>{i({sessionId:w,messageId:_})},[i]),S=g.useMemo(()=>[...u,...o.map(w=>({type:"queued",data:w}))],[u,o]),x=g.useCallback((w,_)=>{if("type"in _&&_.type==="queued"){const N=_.data;return n.jsx(On,{queuedMessage:N,isSending:a===N.id,onRetry:h,onDiscard:b},`queued-${N.id}`)}const j=_,y=w===u.length-1;return n.jsx(Ln,{message:j,isLast:y,commandExecutionByTs:c,onSuggestionClick:p,onCopyToInput:m},j.ts||w)},[u.length,c,p,m,a,h,b]);return s.length===0&&o.length===0?n.jsxs("div",{className:"am-messages-empty",children:[n.jsx(je,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),n.jsx("p",{children:t("messages.waiting")})]}):n.jsx("div",{className:"am-messages-container",children:n.jsx(Vt,{ref:l,data:S,itemContent:x,followOutput:"smooth",increaseViewportBy:{top:400,bottom:400},className:"am-messages-list"})})}function Pn(e){const t=e.text||e.content||"",s=e.metadata??{},o=Ne(t),a=s.question||(o==null?void 0:o.question)||t,r=s.suggest||(o==null?void 0:o.suggest);return a?{question:a,suggestions:r}:null}function Ln({message:e,isLast:t,commandExecutionByTs:s,onSuggestionClick:o,onCopyToInput:a}){const{t:r}=F("agentManager"),d=e.text||e.content||"";let i=n.jsx(je,{size:16}),l=r("messages.kiloSaid"),u=null,c=null,p;if(e.type==="say")switch(e.say){case"api_req_started":{i=n.jsx(Jt,{size:16,className:"opacity-70"}),l=r("messages.apiRequest");const m=Ne(d);(m==null?void 0:m.cost)!==void 0&&(c=n.jsxs("span",{className:"am-message-cost",children:["$",m.cost.toFixed(4)]})),u=null;break}case"text":{i=n.jsx(je,{size:16}),l=r("messages.kiloSaid"),u=n.jsx(W,{content:d});break}case"user_feedback":{i=n.jsx($t,{size:16}),l=r("messages.youSaid"),u=n.jsx(W,{content:d});break}case"completion_result":{i=n.jsx(Xt,{size:16,className:"text-green-500"}),l=r("messages.taskCompleted"),u=n.jsx(W,{content:d});break}case"error":{i=n.jsx(ze,{size:16,className:"text-red-500"}),l=r("messages.error"),u=n.jsx(W,{content:d});break}case"api_req_finished":case"checkpoint_saved":case"command_output":return null;default:u=n.jsx(W,{content:d})}if(e.type==="ask")switch(e.ask){case"followup":{i=n.jsx(Ut,{size:16}),l=r("messages.question");const m=Pn(e);p=m==null?void 0:m.suggestions,u=n.jsx("div",{children:n.jsx(W,{content:(m==null?void 0:m.question)||d})});break}case"command":{i=n.jsx(Oe,{size:16}),l=r("messages.command");const m=s.get(e.ts);u=n.jsx(vt,{text:d,isRunning:(m==null?void 0:m.isRunning)??e.partial,isLast:t,exitCode:m==null?void 0:m.exitCode,terminalStatus:m==null?void 0:m.status});break}case"command_output":return null;case"tool":{const m=e.metadata,h=m!=null&&m.tool?m:Ne(d);if((h==null?void 0:h.tool)==="updateTodoList")return null;if(i=n.jsx(Oe,{size:16}),l=r("messages.tool"),h){const b=h.path?`(${h.path})`:"";u=n.jsx(W,{content:r("messages.usingTool",{tool:h.tool,details:b})})}else u=n.jsx(W,{content:d});break}default:u=n.jsx(W,{content:d})}return n.jsxs("div",{className:`am-message-item ${e.type==="say"&&e.say==="api_req_started"?"am-api-req":""}`,children:[n.jsx("div",{className:"am-message-icon",children:i}),n.jsxs("div",{className:"am-message-content-wrapper",children:[n.jsxs("div",{className:"am-message-header",children:[n.jsx("span",{className:"am-message-author",children:l}),n.jsx("span",{className:"am-message-ts",children:new Date(e.ts).toLocaleTimeString()}),c]}),u&&n.jsx("div",{className:"am-message-body",children:u}),p&&p.length>0&&o&&n.jsx(Tn,{suggestions:p,onSuggestionClick:o,onCopyToInput:a})]})]})}function On({queuedMessage:e,isSending:t,onRetry:s,onDiscard:o}){const{t:a}=F("agentManager");let r=n.jsx(Ve,{size:16,className:"opacity-70"}),d=a("chatInput.messageSending"),i="text-vscode-descriptionForeground";e.status==="sending"?(r=n.jsx(is,{size:16,className:"animate-spin opacity-70"}),d=a("chatInput.messageSending"),i="text-vscode-descriptionForeground"):e.status==="failed"?(r=n.jsx(ze,{size:16,className:"text-vscode-errorForeground"}),d=e.error||"Failed to send message",i="text-vscode-errorForeground"):(r=n.jsx(Ve,{size:16,className:"opacity-70"}),d=a("chatInput.messageSending"),i="text-vscode-descriptionForeground");const l=()=>{s(e.sessionId,e.id)},u=()=>{o(e.sessionId,e.id)},c=e.retryCount<e.maxRetries;return n.jsxs("div",{className:M("am-message-item",e.status==="failed"&&"opacity-75"),children:[n.jsx("div",{className:"am-message-icon",children:r}),n.jsxs("div",{className:"am-message-content-wrapper",children:[n.jsxs("div",{className:"am-message-header",children:[n.jsx("span",{className:"am-message-author text-vscode-descriptionForeground",children:a("messages.youSaid")}),n.jsx("span",{className:M("am-message-ts text-xs",i),children:d})]}),n.jsx("div",{className:"am-message-body",children:n.jsx(W,{content:e.content})}),e.status==="failed"&&n.jsxs("div",{className:"mt-2 space-y-2",children:[e.error&&n.jsxs("p",{className:"text-xs text-vscode-errorForeground",children:["Error: ",e.error]}),e.retryCount>0&&n.jsxs("p",{className:"text-xs text-vscode-descriptionForeground",children:["Retry attempt ",e.retryCount," of ",e.maxRetries]}),n.jsxs("div",{className:"flex gap-2",children:[c&&n.jsx("button",{onClick:l,className:"text-xs px-2 py-1 rounded bg-vscode-button-background hover:bg-vscode-button-hoverBackground text-vscode-button-foreground",children:"Retry"}),n.jsx("button",{onClick:u,className:"text-xs px-2 py-1 rounded bg-vscode-errorBackground hover:opacity-80 text-vscode-errorForeground",children:"Discard"})]})]})]})]})}function qn({status:e,size:t="sm"}){const s=t==="xs"?"w-3 h-3":"w-3.5 h-3.5",o=t==="xs"?"w-2 h-2":"w-2.5 h-2.5";switch(e){case"completed":return n.jsx("div",{className:M("flex items-center justify-center rounded-full bg-green-500/20",s),children:n.jsx(oe,{className:M("text-green-400",o),strokeWidth:3})});case"in_progress":return n.jsx(O,{className:M("text-vscode-charts-yellow animate-spin",s)});default:return n.jsx(ts,{className:M("text-vscode-descriptionForeground/40",s),strokeWidth:2})}}function Wn({stats:e,isIntegrated:t=!1}){const{t:s}=F("chat"),[o,a]=g.useState(!1),r=g.useRef(null),{todos:d,completedCount:i,totalCount:l,currentTodo:u,allCompleted:c,progressPercent:p}=e;return g.useEffect(()=>{if(!o||!r.current)return;const m=d.findIndex(S=>S.status==="in_progress");if(m===-1)return;const b=r.current.querySelectorAll("[data-todo-item]")[m];b&&b.scrollIntoView({behavior:"smooth",block:"center"})},[o,d]),l<=0?null:n.jsxs("div",{className:M("overflow-hidden transition-all duration-200",t?"border-b border-vscode-input-border/50":"rounded-t-md border-x border-t border-vscode-input-border","bg-vscode-input-background"),children:[n.jsxs("button",{type:"button",onClick:()=>a(!o),className:M("w-full flex items-center gap-2 px-3 py-1.5","hover:bg-vscode-list-hoverBackground/30 transition-colors","focus:outline-none","cursor-pointer"),children:[n.jsxs("div",{className:"relative flex-shrink-0",children:[n.jsxs("svg",{className:"w-4 h-4 -rotate-90",viewBox:"0 0 16 16",children:[n.jsx("circle",{cx:"8",cy:"8",r:"6",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-vscode-input-border/40"}),n.jsx("circle",{cx:"8",cy:"8",r:"6",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:`${p*.377} 100`,strokeLinecap:"round",className:M("transition-all duration-300",c?"text-green-400":"text-vscode-charts-yellow")})]}),c&&n.jsx(oe,{className:"absolute inset-0 m-auto w-2 h-2 text-green-400",strokeWidth:3})]}),n.jsx("span",{className:M("flex-1 text-xs truncate text-left",c?"text-green-400":"text-vscode-foreground"),children:c?s("todo.complete",{total:i}):(u==null?void 0:u.content)||s("todo.partial",{completed:i,total:l})}),n.jsxs("span",{className:"flex-shrink-0 text-[10px] text-vscode-descriptionForeground/70 tabular-nums",children:[i,"/",l]}),o?n.jsx(ne,{className:"w-3 h-3 text-vscode-descriptionForeground/50"}):n.jsx(kt,{className:"w-3 h-3 text-vscode-descriptionForeground/50"})]}),o&&n.jsx("div",{ref:r,className:"max-h-[140px] overflow-y-auto border-t border-vscode-input-border/50",children:n.jsx("div",{className:"py-1 px-1",children:d.map((m,h)=>n.jsxs("div",{"data-todo-item":!0,className:M("flex items-center gap-2 py-0.5 px-2 rounded transition-colors",m.status==="in_progress"&&"bg-vscode-charts-yellow/10"),children:[n.jsx(qn,{status:m.status,size:"xs"}),n.jsx("span",{className:M("text-xs truncate",m.status==="in_progress"&&"text-vscode-charts-yellow",m.status==="completed"&&"line-through text-vscode-descriptionForeground/50",m.status==="pending"&&"text-vscode-descriptionForeground"),children:m.content})]},m.id||h))})})]})}const Vn=({sessionId:e,sessionLabel:t,isActive:s=!1,showCancel:o=!1,showFinishToBranch:a=!1,showCreatePR:r=!1,worktreeBranchName:d,parentBranch:i,sessionStatus:l,modelId:u})=>{const{t:c}=F("agentManager"),[p,m]=he(ct(e)),h=E(un(e)),b=E(be),[S,x]=g.useState(!1),w=g.useRef(null),_=T(kn),j=g.useMemo(()=>b?b.models.map(I=>({value:I.id,label:I.displayName||I.id,description:I.contextWindow?`${Math.floor(I.contextWindow/1e3)}K context`:void 0})):[],[b]);g.useEffect(()=>{var I;(I=w.current)==null||I.focus()},[e]);const y=p.trim(),N=y.length===0,k=l==="done"||l==="error"||l==="stopped",D=N,A=()=>{if(!N)if(k)R.postMessage({type:"agentManager.resumeSession",sessionId:e,sessionLabel:t,content:y}),m("");else{const I=_({sessionId:e,content:y});I&&(R.postMessage({type:"agentManager.messageQueued",sessionId:e,messageId:I.id,sessionLabel:t,content:y}),m(""))}},U=()=>{R.postMessage({type:"agentManager.cancelSession",sessionId:e})},B=()=>{R.postMessage({type:"agentManager.finishWorktreeSession",sessionId:e})},L=()=>{const I=d||"current-branch",ie=i||"main",ee=`The user wants to create a pull request.

Local branch: ${I}
Target branch: origin/${ie}

Follow these steps:

1. First, verify gh CLI is ready by running: gh auth status
   - If gh is not installed, ask the user to install it: https://cli.github.com/
   - If not authenticated, ask the user to run: gh auth login
   - Do not proceed until gh is ready.

2. Run git status to check for uncommitted changes

3. Run git diff to understand what changes exist (both staged and unstaged)

4. Based on the changes, prepare suggestions for the user:
   - Propose a CLEAN branch name following conventions (e.g., feat/description, fix/description, docs/description)
     Do NOT suggest the auto-generated local branch name "${I}" - always propose a better name.
   - Propose a descriptive commit message (if there are uncommitted changes)
   - Propose a PR title (under 80 chars)
   - Propose a PR description (concise summary)

5. STOP and present your suggestions to the user. Ask them to confirm or edit:
   - Branch name for the PR (your clean suggestion, not the auto-generated one)
   - Commit message (if applicable)
   - PR title
   - PR description

   DO NOT commit, push, or create the PR until the user explicitly confirms.

6. Once the user confirms, execute in this order:
   a. If there are uncommitted changes, commit with the confirmed message
   b. Push to origin with the confirmed branch name:
      git push origin ${I}:<confirmed-branch-name>
   c. Create the PR: gh pr create --base ${ie} --head <confirmed-branch-name> --title "<confirmed-title>" --body "<confirmed-description>"

If any step fails, ask the user for help.`;if(k)R.postMessage({type:"agentManager.resumeSession",sessionId:e,sessionLabel:t,content:ee});else{const ce=_({sessionId:e,content:ee});ce&&R.postMessage({type:"agentManager.messageQueued",sessionId:e,messageId:ce.id,sessionLabel:t,content:ee})}},te=I=>{I.key==="Enter"&&!I.shiftKey&&!I.nativeEvent.isComposing&&(I.preventDefault(),A())},Q=h.totalCount>0;return n.jsx("div",{className:"am-chat-input-container",children:n.jsxs("div",{className:M("relative flex-1 flex flex-col min-h-0 overflow-hidden rounded",Q&&["border bg-vscode-input-background",S?"border-vscode-focusBorder outline outline-vscode-focusBorder":"border-vscode-input-border"]),children:[Q&&n.jsx(Wn,{stats:h,isIntegrated:!0}),n.jsxs("div",{className:M("relative","flex-1","flex","flex-col-reverse","min-h-0","overflow-hidden"),children:[n.jsx(Ze,{ref:w,value:p,onChange:I=>m(I.target.value),onKeyDown:te,onFocus:()=>x(!0),onBlur:()=>x(!1),"aria-label":c("chatInput.ariaLabel"),placeholder:c("chatInput.placeholderTypeTask"),minRows:3,maxRows:15,className:M("w-full","text-vscode-input-foreground","font-vscode-font-family","text-vscode-editor-font-size","leading-vscode-editor-line-height","cursor-text","!pt-3 !pl-3 pr-9",!Q&&[S?"border border-vscode-focusBorder outline outline-vscode-focusBorder":"border border-vscode-input-border","rounded"],"bg-vscode-input-background","transition-background-color duration-150 ease-in-out","will-change-background-color","min-h-[90px]","box-border","resize-none","overflow-x-hidden","overflow-y-auto","!pb-10","flex-none flex-grow","z-[2]","scrollbar-none","scrollbar-hide")}),n.jsx("div",{className:"absolute bottom-[1px] left-2 right-2 h-10 bg-gradient-to-t from-[var(--vscode-input-background)] via-[var(--vscode-input-background)] to-transparent pointer-events-none z-[2]","aria-hidden":"true"}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-30 flex items-center gap-1",children:[u&&j.length>0&&n.jsx("div",{className:"am-model-selector mr-1",children:n.jsx(Qe,{value:u,options:j,onChange:()=>{},disabled:!0,triggerClassName:"am-model-selector-trigger",contentClassName:"am-model-selector-content",align:"end"})}),a&&n.jsx(Z,{content:d?c("chatInput.finishToBranchTitle",{branch:d}):c("chatInput.finishToBranchTitleNoBranch"),children:n.jsx("button",{"aria-label":d?c("chatInput.finishToBranchTitle",{branch:d}):c("chatInput.finishToBranchTitleNoBranch"),onClick:B,className:M("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]","cursor-pointer"),children:n.jsx(K,{size:14})})}),r&&n.jsx(Z,{content:c("chatInput.createPRTitle"),children:n.jsx("button",{"aria-label":c("chatInput.createPRTitle"),onClick:L,className:M("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]","cursor-pointer"),children:n.jsx(ns,{size:14})})}),s&&o&&n.jsx(Z,{content:c("chatInput.cancelTitle"),children:n.jsx("button",{"aria-label":c("chatInput.cancelTitle"),onClick:U,className:M("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-errorForeground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]","cursor-pointer"),children:n.jsx(Ht,{size:14,fill:"currentColor"})})}),n.jsx(Z,{content:c("chatInput.sendTitle"),children:n.jsx("button",{"aria-label":c("chatInput.sendTitle"),disabled:D,onClick:A,className:M("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]",!D&&"cursor-pointer",D&&"opacity-40 cursor-not-allowed grayscale-[30%] hover:bg-transparent hover:border-[rgba(255,255,255,0.08)] active:bg-transparent"),children:n.jsx(Je,{className:"w-4 h-4 rtl:-scale-x-100"})})})]}),!p&&n.jsx("div",{className:"absolute left-3 right-[100px] z-30 flex items-center h-8 overflow-hidden text-ellipsis whitespace-nowrap",style:{bottom:"0.25rem",color:"var(--vscode-descriptionForeground)",opacity:.7,fontSize:"11px",userSelect:"none",pointerEvents:"none"},children:c("chatInput.hint")})]})]})})};function $n({selectedBranch:e,onSelect:t,onClose:s}){const{t:o}=F("agentManager"),a=E(mt),r=E(pt),d=r&&a.includes(r)?[r]:[],i=a.filter(c=>c!==r),l=g.useCallback(c=>{t(c),s()},[t,s]);g.useEffect(()=>{const c=p=>{p.key==="Escape"&&s()};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[s]);const u=c=>{c.target===c.currentTarget&&s()};return a.length===0?n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50",onClick:u,children:n.jsxs("div",{className:"bg-vscode-editor-background border border-vscode-editorWidget-border rounded-md shadow-lg w-96 p-4 text-center text-vscode-descriptionForeground",children:[n.jsx(K,{size:24,className:"mx-auto mb-2 opacity-50"}),o("sessionDetail.noBranches")]})}):n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center pt-20 z-50",onClick:u,children:n.jsxs(St,{className:"bg-vscode-editor-background border border-vscode-editorWidget-border rounded-md shadow-lg w-96 max-h-96 flex flex-col overflow-hidden",children:[n.jsx(jt,{placeholder:o("sessionDetail.searchBranches"),autoFocus:!0}),n.jsxs(Nt,{children:[n.jsx(Mt,{children:o("sessionDetail.noMatchingBranches")}),d.length>0&&n.jsx(qe,{heading:o("sessionDetail.yourBranches"),children:d.map(c=>n.jsxs(We,{value:c,onSelect:()=>l(c),children:[n.jsx(K,{size:12,className:"flex-shrink-0"}),n.jsx("span",{className:"truncate flex-1",children:c}),e===c&&n.jsx(oe,{size:12,className:"ml-auto"})]},c))}),d.length>0&&i.length>0&&n.jsx(Ct,{}),i.length>0&&n.jsx(qe,{heading:o("sessionDetail.otherBranches"),children:i.map(c=>n.jsxs(We,{value:c,onSelect:()=>l(c),children:[n.jsx(K,{size:12,className:"flex-shrink-0"}),n.jsx("span",{className:"truncate flex-1",children:c}),e===c&&n.jsx(oe,{size:12,className:"ml-auto"})]},c))})]})]})})}const Un=()=>n.jsx("svg",{id:"Layer_2","data-name":"Layer 2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:"100%",height:"100%",style:{display:"block"},children:n.jsx("g",{id:"Kilo_Code_Branding","data-name":"Kilo Code Branding",children:n.jsx("path",{id:"Logo_Outline_-_White","data-name":"Logo Outline - White",fill:"currentColor",d:"M0,0v100h100V0H0ZM92.5925926,92.5925926H7.4074074V7.4074074h85.1851852v85.1851852ZM61.1111044,71.9096084h9.2592593v7.4074074h-11.6402116l-5.026455-5.026455v-11.6402116h7.4074074v9.2592593ZM77.7777711,71.9096084h-7.4074074v-9.2592593h-9.2592593v-7.4074074h11.6402116l5.026455,5.026455v11.6402116ZM46.2962963,61.1114207h-7.4074074v-7.4074074h7.4074074v7.4074074ZM22.2222222,53.7040133h7.4074074v16.6666667h16.6666667v7.4074074h-19.047619l-5.026455-5.026455v-19.047619ZM77.7777711,38.8888889v7.4074074h-24.0740741v-7.4074074h8.2781918v-9.2592593h-8.2781918v-7.4074074h10.6591442l5.026455,5.026455v11.6402116h8.3884749ZM29.6296296,30.5555556h9.2592593l7.4074074,7.4074074v8.3333333h-7.4074074v-8.3333333h-9.2592593v8.3333333h-7.4074074v-24.0740741h7.4074074v8.3333333ZM46.2962963,30.5555556h-7.4074074v-8.3333333h7.4074074v8.3333333Z"})})});function Hn(){var w,_,j;const{t:e}=F("agentManager"),t=E(en),s=E(De),o=E($),a=E(an),r=g.useRef(void 0),d=g.useMemo(()=>xt(e),[e]);if(g.useEffect(()=>{if(!t)return;const y=r.current,N={id:t.sessionId,status:t.status};r.current=N,(y==null?void 0:y.id)===N.id&&y.status==="running"&&N.status!=="running"&&R.postMessage({type:"agentManager.cancelSession",sessionId:t.sessionId})},[t]),s&&!t)return n.jsx(Kn,{pendingSession:s});if(!t)return n.jsx(Qn,{});const i=o[t.sessionId],l=(i==null?void 0:i.isActive)??!1,u=(i==null?void 0:i.showSpinner)??!1,c=(w=t.parallelMode)==null?void 0:w.enabled,p=(_=t.parallelMode)==null?void 0:_.branch,m=t.sessionId.startsWith("provisional-"),h=t.status==="running",b=!!c&&h,S=!!c&&!!p,x=(j=t.parallelMode)==null?void 0:j.parentBranch;return n.jsxs("div",{className:"am-session-detail",children:[n.jsxs("div",{className:"am-detail-header",children:[n.jsxs("div",{className:"am-header-info",children:[n.jsx("div",{className:"am-header-title",title:t.prompt,children:t.label}),n.jsxs("div",{className:"am-header-meta",children:[u&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[n.jsx(O,{size:12,className:"am-spinning"}),n.jsx("span",{children:e(a==="creating"?"status.creating":"status.running")})]}),n.jsx("span",{children:ft(t.startTime,d)}),c?n.jsxs("div",{className:"am-worktree-badge",style:{display:"flex",alignItems:"center",gap:4},title:p||e("sessionDetail.runningInWorktree"),children:[n.jsx(K,{size:12}),n.jsx("span",{children:p||e("sidebar.worktree")})]}):n.jsxs("div",{className:"am-local-badge",style:{display:"flex",alignItems:"center",gap:4},title:e("sessionDetail.runningLocally"),children:[n.jsx(le,{size:12}),n.jsx("span",{children:e("sessionDetail.runModeLocal")})]})]})]}),n.jsx("div",{className:"am-header-actions",children:!m&&n.jsx("button",{className:"am-icon-btn",onClick:()=>{R.postMessage({type:"agentManager.showTerminal",sessionId:t.sessionId})},"aria-label":e("sessionDetail.openTerminal"),title:e("sessionDetail.openTerminal"),children:n.jsx(ls,{size:14})})})]}),t.status==="error"&&t.error&&n.jsxs("div",{className:"am-session-error-banner",role:"alert",children:[n.jsx(ze,{size:16}),n.jsx("span",{children:t.error})]}),l&&n.jsxs("div",{className:"am-full-auto-banner",children:[n.jsx(Kt,{size:14}),n.jsx("span",{children:e("sessionDetail.autoModeWarning")})]}),n.jsx(Fn,{sessionId:t.sessionId}),n.jsx(Vn,{sessionId:t.sessionId,sessionLabel:t.label,isActive:l,showCancel:l,showFinishToBranch:b,showCreatePR:S,worktreeBranchName:p,parentBranch:x,sessionStatus:t.status,modelId:t.model})]})}function Kn({pendingSession:e}){const{t}=F("agentManager"),s=()=>{R.postMessage({type:"agentManager.cancelPendingSession"})};return n.jsxs("div",{className:"am-session-detail",children:[n.jsxs("div",{className:"am-detail-header",children:[n.jsxs("div",{className:"am-header-info",children:[n.jsx("div",{className:"am-header-title",title:e.prompt,children:e.label}),n.jsx("div",{className:"am-header-meta",children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[n.jsx(O,{size:12,className:"am-spinning"}),n.jsx("span",{children:t("status.creating")})]})})]}),n.jsx("div",{className:"am-header-actions",children:n.jsx("button",{className:"am-icon-btn",onClick:s,"aria-label":t("sessionDetail.cancelCreating"),title:t("sessionDetail.cancelCreating"),children:n.jsx(At,{size:14})})})]}),n.jsxs("div",{className:"am-center-form",children:[n.jsx(O,{size:48,className:"am-spinning",style:{opacity:.5}}),n.jsx("h2",{style:{marginTop:16},children:t("sessionDetail.creatingSession")}),n.jsx("p",{children:t("sessionDetail.waitingForCli")}),n.jsx("button",{className:"am-cancel-btn",onClick:s,style:{marginTop:16},children:t("sessionDetail.cancelButton")})]})]})}function Qn(){const{t:e}=F("agentManager"),[t,s]=g.useState(""),[o,a]=he(Ks),[r,d]=he(Js),i=T(vn),l=E(be),u=E(Pe),c=E(gn),[p,m]=g.useState(!1),[h,b]=g.useState(!1),[S,x]=g.useState(!1),[w,_]=g.useState(!1),[j,y]=g.useState(null),[N,k]=g.useState(!1),D=g.useRef(null),A=g.useRef(null),U=E(it),B=r>1,L=B?"worktree":o;g.useEffect(()=>{U>0&&m(!1)},[U]),g.useEffect(()=>{R.postMessage({type:"agentManager.listBranches"})},[]),g.useEffect(()=>{L==="worktree"&&R.postMessage({type:"agentManager.listBranches"})},[L]),g.useEffect(()=>{const C=Le=>{D.current&&!D.current.contains(Le.target)&&x(!1),A.current&&!A.current.contains(Le.target)&&_(!1)};return(S||w)&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[S,w]);const te=t.trim(),Q=te.length===0,I=()=>{if(Q||p)return;m(!0);const C=B?Gs(te.slice(0,50),r):void 0;R.postMessage({type:"agentManager.startSession",prompt:te,parallelMode:L==="worktree",versions:r,labels:C,existingBranch:j||void 0,model:c||void 0})},ie=C=>{C.key==="Enter"&&!C.shiftKey&&!C.nativeEvent.isComposing&&(C.preventDefault(),I())},ee=C=>{a(C),x(!1)},ce=C=>{d(C),_(!1)},bt=g.useMemo(()=>l?l.models.map(C=>({value:C.id,label:C.displayName||C.id,description:C.contextWindow?`${Math.floor(C.contextWindow/1e3)}K context`:void 0})):[],[l]),yt=l&&l.models.length>0;return n.jsxs("div",{className:"am-center-form",children:[n.jsx("div",{className:"text-[var(--vscode-editor-foreground)]",style:{width:48,height:48,margin:"0 auto 16px auto"},children:n.jsx(Un,{})}),n.jsx("div",{style:{width:"100%",maxWidth:"100%",minWidth:"280px"},children:n.jsxs("div",{className:M("relative","flex","flex-col-reverse","min-h-0","overflow-visible","rounded"),children:[n.jsx(Ze,{autoFocus:!0,value:t,onChange:C=>s(C.target.value),onKeyDown:ie,onFocus:()=>b(!0),onBlur:()=>b(!1),"aria-label":e("sessionDetail.startNewAgent"),disabled:p,placeholder:e("sessionDetail.placeholderTask"),minRows:5,maxRows:12,style:{paddingTop:"12px",paddingBottom:"40px",paddingLeft:"16px",paddingRight:"36px"},className:M("w-full","text-vscode-input-foreground","font-vscode-font-family","text-vscode-editor-font-size","leading-vscode-editor-line-height","cursor-text",h?"border border-vscode-focusBorder outline outline-vscode-focusBorder":"border border-vscode-input-border","bg-vscode-input-background","transition-background-color duration-150 ease-in-out","will-change-background-color","box-border","rounded","resize-none","overflow-x-hidden","overflow-y-auto","flex-none flex-grow","z-[2]","scrollbar-none","scrollbar-hide")}),n.jsx("div",{className:"absolute bottom-[1px] left-2 right-2 h-10 bg-gradient-to-t from-[var(--vscode-input-background)] via-[var(--vscode-input-background)] to-transparent pointer-events-none z-[2]","aria-hidden":"true"}),n.jsxs("div",{className:"absolute bottom-2 right-2 z-30 flex items-center gap-2",children:[n.jsxs("div",{ref:D,className:"am-run-mode-dropdown-inline relative",children:[n.jsx(Z,{content:B?e("sessionDetail.versionsHelperText",{count:r}):e(L==="local"?"sessionDetail.runModeLocal":"sessionDetail.runModeWorktree"),children:n.jsxs("button",{className:M("am-run-mode-trigger-inline",B&&"am-locked"),onClick:()=>!B&&x(!S),disabled:p||B,type:"button",children:[L==="local"?n.jsx(le,{size:14}):n.jsx(K,{size:14}),!B&&n.jsx(ne,{size:10,className:M("am-chevron",S&&"am-open")})]})}),S&&!B&&n.jsxs("div",{className:"am-run-mode-menu-inline",children:[n.jsxs("button",{className:M("am-run-mode-option-inline",o==="local"&&"am-selected"),onClick:()=>ee("local"),type:"button",children:[n.jsx(le,{size:12}),n.jsx("span",{children:e("sessionDetail.runModeLocal")}),o==="local"&&n.jsx("span",{className:"am-checkmark",children:""})]}),n.jsxs("button",{className:M("am-run-mode-option-inline",o==="worktree"&&"am-selected"),onClick:()=>ee("worktree"),type:"button",children:[n.jsx(K,{size:12}),n.jsx("span",{className:"am-run-mode-label",children:e("sessionDetail.runModeWorktree")}),o==="worktree"&&n.jsx("span",{className:"am-checkmark",children:""})]})]})]}),n.jsxs("div",{ref:A,className:"am-run-mode-dropdown-inline relative",children:[n.jsx(Z,{content:e("sessionDetail.versionsTooltip"),children:n.jsxs("button",{className:"am-run-mode-trigger-inline",onClick:()=>_(!w),disabled:p,type:"button",title:e("sessionDetail.versions"),children:[n.jsx(as,{size:14}),n.jsx("span",{className:"am-version-count",children:r}),n.jsx(ne,{size:10,className:M("am-chevron",w&&"am-open")})]})}),w&&n.jsx("div",{className:"am-run-mode-menu-inline",children:Zs.map(C=>n.jsxs("button",{className:M("am-run-mode-option-inline",r===C&&"am-selected"),onClick:()=>ce(C),type:"button",children:[n.jsx("span",{children:e("sessionDetail.versionCount",{count:C})}),r===C&&n.jsx("span",{className:"am-checkmark",children:""})]},C))})]}),u?n.jsxs("div",{className:"am-run-mode-trigger-inline opacity-70",children:[n.jsx(O,{size:14,className:"am-spinning"}),n.jsx("span",{className:"text-sm",children:e("sessionDetail.loadingModels")})]}):yt?n.jsx("div",{className:"am-model-selector",children:n.jsx(Qe,{value:c||"",options:bt,onChange:C=>i(C),disabled:p,placeholder:e("sessionDetail.selectModel"),title:e("sessionDetail.modelTooltip"),triggerClassName:"am-model-selector-trigger",contentClassName:"am-model-selector-content",align:"end"})}):null,L==="worktree"&&!B&&n.jsx(Z,{content:e("sessionDetail.branchPickerTooltip"),children:n.jsxs("button",{className:"am-run-mode-trigger-inline",onClick:()=>k(!0),disabled:p,type:"button",title:e("sessionDetail.selectBranch"),children:[n.jsx(K,{size:14}),n.jsx("span",{className:"truncate max-w-[80px] text-sm",children:j||e("sessionDetail.selectBranch")}),n.jsx(ne,{size:10,className:"am-chevron"})]})}),n.jsx("button",{className:M("relative inline-flex items-center justify-center","bg-transparent border-none p-1.5","rounded-md min-w-[28px] min-h-[28px]","opacity-60 hover:opacity-100 text-vscode-descriptionForeground hover:text-vscode-foreground","transition-all duration-150","hover:bg-[rgba(255,255,255,0.03)] hover:border-[rgba(255,255,255,0.15)]","focus:outline-none focus-visible:ring-1 focus-visible:ring-vscode-focusBorder","active:bg-[rgba(255,255,255,0.1)]",!Q&&!p&&"cursor-pointer",(Q||p)&&"opacity-40 cursor-not-allowed grayscale-[30%] hover:bg-transparent hover:border-[rgba(255,255,255,0.08)] active:bg-transparent"),onClick:I,disabled:Q||p,"aria-label":e(p?"sessionDetail.starting":"sessionDetail.startAriaLabel"),title:B?e("sessionDetail.launchVersions",{count:r}):e("sessionDetail.startAgent"),children:p?n.jsx(O,{size:16,className:"am-spinning"}):n.jsx(Je,{size:16})})]})]})}),N&&n.jsx($n,{selectedBranch:j,onSelect:y,onClose:()=>k(!1)})]})}function Zn(){return n.jsx(Ts,{children:n.jsx(It,{delayDuration:Tt,children:n.jsx(Jn,{})})})}function Jn(){wn();const e=E(V);return Mn(e),n.jsxs("div",{className:"agent-manager-container",children:[n.jsx(Cn,{}),n.jsx(Hn,{})]})}Et();const Ke=document.getElementById("root");Ke&&Rt.createRoot(Ke).render(n.jsx(Be.StrictMode,{children:n.jsx(Qt,{i18n:Bt,children:n.jsx("div",{className:"am-app-wrapper",children:n.jsx(zt,{children:n.jsx(Zn,{})})})})}));R.postMessage({type:"agentManager.webviewReady"});
//# sourceMappingURL=agent-manager.js.map
